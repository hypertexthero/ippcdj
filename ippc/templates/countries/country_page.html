{% extends "base.html" %}
{% load pages_tags translate_tags mezzanine_tags i18n future staticfiles accounts_tags %}

{% block meta_title %}
  {{ page.title }}
{% endblock %}

{% block breadcrumb_menu %}
<li>
  <a href="/">{% trans "Home" %}</a>
  <span class="divider">/</span>
</li>
<li>
  <a href="/countries/">{% trans "Countries" %}</a>
  <span class="divider">/</span>
</li>
<li class="active">
      {{ page.title }}
</li>
<li class="pull-right">
  {% include "countries/country_selector.html" %}
</li>
{% endblock %}

{% block main %}
  {% if user.is_superuser %} 
  <div class="pull-right">
      <a class="btn btn-small btn-info" href="/admin/ippc/countrypage/{{ page.id }}">Edit page as Admin <small>(also contact point &amp; editors relation)</a><br>
  </div>
  {% endif %}

  <h1>
      {{ page.title }} <img src="{{page.get_content_model.country.flag}}">
  </h1> 

  <div class="panel contact-info">
  <h2>{% trans "Contact Point" %}</h2>
    {% include "accounts/account_contactpoint_details.html" %}
  </div>

  {# =todo: description of nppo here #}
  {# <h2>Description of NPPO</h2> #}
  {# {% with page.richtextpage|get_object_translation as translated_page %} #}
  {#     {{ translated_page.content|richtext_filter|safe }} #}
  {# {% endwith %} #}


  {# if there are any editors defined for this country page, only admins can see them here #}
  {% if page.get_content_model.editors.all and user.is_superuser %} 
  <h3>Editors</h3>
  <table class="table table-condensed table-striped">
    <thead>
      <tr>
        <th>{% trans "Name" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for editor in page.get_content_model.editors.all %}
        <tr>
          <td>{{ editor.get_profile.first_name }} {{ editor.get_profile.last_name }} <a class="btn btn-small btn-info pull-right" href="/admin/auth/user/{{ editor.get_profile.id }}">Edit User as Admin</a><br></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
{% endblock %}

{% block local_nav %}
<div class="panel">    
    <ul class="nav nav-list">
      <li class="nav-header">{{ page.title }}</li>
      <li><a href="{% url 'pest-report-list' page.title|slugify %}">Official Pest Reports</a> 
        
        {% if perms.ippc.add_pestreport and request.user.get_profile.country.name == page.title or user.is_superuser %}
          <small><a class="btn btn-small btn-info" href="{% url 'pest-report-create' page.title|slugify %}">+ {% trans "Add new" %}</a></small>
        {% else %}
        {% endif %}
      
      </li>
      <li class="divider"></li>
      <li><a href="{% url 'basic-reporting-list' page.title|slugify %}">Reporting Obligations</a> 
      <table>  {% for key, val in basic_types %}
        <tr>
          <td>
          <small class="muted">{{val}}</small></td>
          <td>{% if perms.ippc.add_basicreporting and request.user.get_profile.country.name == page.title or user.is_superuser %}
                <small><a class="btn btn-small btn-info" href="{% url 'basic-reporting-create' page.title|slugify key %}">+ {% trans "Add new" %}</a></small>
             {% endif %} 
          </td>
        </tr>
        {% endfor %} 
        </table>        
          
       </li>
    
      <li class="divider"></li>
       <li><a href="{% url 'event-reporting-list' page.title|slugify %}">Event Reporting</a> 
          <table>
        {% for key, val in event_types %}
        <tr>
          <td>
          <small class="muted">{{val}}</small></td>
          <td>{% if perms.ippc.add_eventreporting and request.user.get_profile.country.name == page.title or user.is_superuser %}
                <small><a class="btn btn-small btn-info" href="{% url 'event-reporting-create' page.title|slugify key %}">+ {% trans "Add new" %}</a></small>
             {% endif %} 
          </td>
        </tr>
        {% endfor %} 
        </table>        

      
      </li>
    
      <li class="divider"></li>
      
       <li><a href="{% url 'pfa-list' page.title|slugify %}">Pest-Free Area or Area of Low Pest Prevalence</a> 
        
        {% if perms.ippc.add_pestfreearea and request.user.get_profile.country.name == page.title or user.is_superuser %}
          <small><a class="btn btn-small btn-info" href="{% url 'pfa-create' page.title|slugify %}">+ {% trans "Add new" %}</a></small>
        {% else %}
        {% endif %}
      
      </li>
     <li class="divider"></li>
      
       <li><a href="{% url 'implementationispm-list' page.title|slugify %}">Implementation of ISPM 15</a> 
        
        {% if perms.ippc.add_implementationispm and request.user.get_profile.country.name == page.title or user.is_superuser %}
          <small><a class="btn btn-small btn-info" href="{% url 'implementationispm-create' page.title|slugify %}">+ {% trans "Add new" %}</a></small>
        {% else %}
        {% endif %}
      
      </li>
      <li class="divider"></li>
      <li><a href="#">Publication</a></li>
      <li><a href="#">News Item</a></li>
      <li><a href="#">Event</a></li>
      <li><a href="#">News Item</a></li>
      <li><a href="http://phytosanitary.info/user/login?destination=node/add" target="_blank">Project <span class="small">(go to phytosanitary.info)</span></a></li>
    </ul>
</div>  
  {# =todo: link to this country's RSS feed here. #}
{% endblock local_nav %}

{% block pageinfo %}
{% endblock pageinfo %}